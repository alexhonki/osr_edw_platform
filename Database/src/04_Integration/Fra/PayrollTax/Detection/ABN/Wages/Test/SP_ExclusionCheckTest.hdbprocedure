PROCEDURE "osr.edw.platform.fra.prt.dt.abn.wages.test::SP_ExclusionCheckTest"
( 	IN iv_abn				         NVARCHAR(11) ,
	IN iv_gjahr				         NVARCHAR(4)  ,
	IN iv_role_dt           		 NVARCHAR(8)  ,
	IN iv_pt_role           		 NVARCHAR(1)  ,
	IN iv_id_role           		 NVARCHAR(1)  ,
	IN iv_pt_case_dt            	 NVARCHAR(8)  ,
	IN iv_pt_case           		 NVARCHAR(1)  ,
	IN iv_flag_abr_acnc              NVARCHAR(1)  ,
	IN iv_flag_asic_regd             NVARCHAR(1)  ,
	IN iv_flag_sup_gov_exmpt_anzsic  NVARCHAR(1)  ,
	OUT lt_workset			"osr.edw.platform.fra.prt.dt.abn::Types.wages.ws",
	OUT lt_out_for_rule		"osr.edw.platform.fra.prt.dt.abn::Types.wages.data_exclusions",
--	OUT lt_param			"osr.edw.platform.fra.prt.dt.abn::Types.wages.param_data_exclusions",
	OUT et_result       	"osr.edw.platform.fra.prt.dt.abn::Types.wages.result",
	OUT et_text             "osr.edw.platform.fra.prt.dt.abn::Types.wages.text"

	)
   LANGUAGE SQLSCRIPT
   SQL SECURITY INVOKER
   --DEFAULT SCHEMA <default_schema_name>
   READS SQL DATA AS
BEGIN
   /*************************************
       Write your procedure logic 
   *************************************/
   
   IF :iv_abn = '?' THEN 
   lt_workset =
		SELECT 
			"ABN",
			"PERIOD_CATEGORY",
			"PERIOD_KEY",
			"GJAHR"
		FROM
		"osr.edw.platform.fra.prt.dt.abn.wages::CV_ABN_WAGES_KEYS"
--		WHERE "ABN" IN ('19260278981','52945927066','80326935851','60665432553','96932856240','52018204808','69045491808','24603467024','37417474709','42931784103','41120357833','79088348958','19108283540','57525935419','44147431627','56192927928','65104710787','34280945411','74160906182','73236067767','24690169122','23561904834','53223317635','54934697299','67131752657','67449738159','57001594074','88626879751','89149844128','64122087281','91967940892','81068235398','87600333622','25023841736','14882123363','21232129816','46098191498','33123040442','67757001303','92456457335','60662072775','90952801237','58023656939','61354551576','56782698956','90970605069','61082034393','60168531724','90119456237','91021040318','60105227987','97329483372','27180011678','80973805243','97621239356','79578875531','48264545457','15950135854','15072238554','80601716778','90085953331','87721201287','67131752657','48738917341','24603467024','29252806279','54141228346','79602462309','15922811250','46150125723','39563851304','64087372398','84023606313','71610053113','35080496993','29003850619','15347659323','92006533606','68100902921','38723007669','11805856055','40005498775','89078949710','29079775359','42004355739','83543468056','99700687141','12499095112','57151686798','22054925101','52164392750','78160062126','49107077930','12117854841','67607946841','88869962393','43037816628','82163458571','98612261364','77130606978','82612907758','53601495916','45162974478','72613494974','19612189330','89079859340','38159323707','71050057620','86000032422','34132984546','37169974047','62061283823','92124762027','26000755153','82167867423','43136429948','35088197237','47008528461','12163935368','39163549924','13002794318','33164634039','88167111239','29086789004','76077825355','57009479958','21167760607','15101038331','23160392898','98082012673','84007325313','82079913125','29612651064','93093899962','21006566972','29166076642','95113695453','81057619986','42004355739','20132057384','91613553736','64133262414','86140384470','84609268448','52139242676','66164786985','24094935583','75002459672','91604132167','67159703349','16119520133','24125171155','20131645979','65001824139','99120104083','48154924642','50610162886','66145671709','41606843056','71066281132','69614856576','47144975413','54002794998','87610494721','45056257777','94050110346','49167433034','83165705073','38611985365','67162349171','11000296631','51152952737','29123695438','85140448013','52008942836','25609554065','77027278864','49008528470','43932956053','44612212905','42102193582','12147668522','23091232156','98613069382','31145199775','31163233092','86166690937','86166690937','75164397399','17611379385','54152762331','71161327331','41118359649','50092264287','17158970480','26609344210','62139995681','18155472067','38145412308','84610622234','29009548618','35108483601','84609642604','63610405939','48160564661','18604743811','85123240362','36165578156','40002963788','37163346594','27167737144','42164777093','77163274673','46006178641','11114688541','51161718994','31162093870','85160363931','65149197651','66130620192','21604932112','67131847811','13087129995','21611641331','42159228145','15610150957','72150664565','91609864208','81141534269','15159974946','94130064274','44142923653','58120320121','21602984574','97604873878','21122939299','77162864824','42612614230','71472990847','54166562312','75092980893','80611339514','44106457005','95132699748','56607097021','61354551576','41131943210','79003014891','75611805620','74457506140','52096827048','73073829606','66736734045','12010657351','32089603314','69097952657','32141004239','41810234213','40075120517','44158513734','27002369557','76605682979','97000710074','11010652918','52118797989','47140180169','77105326814','16087937531','39237868051','49606221363','29129169802','69126226846','30163127857','38610707536','79140932878','62022025439','44815879311','95082812146','38697378930','67114736113','15604937457','53168383257','98002659467','47167481263','50161454860','57165826915','61162010979','86600432880','88003488873','92140312385','92143803070','27250451282','28143251183','81067610888','67084811932','41010887591','90055506208','87003008884','66001280628','21002407589','37000029863','53082094308','40090953236','42077750693','61122807363','99122891838','26134439259','47127885223','35080473978','69128811503','19108602151','44118225559','86976181243','86112089102','33114965276','67113976408','68137130182','47128920392','11069690697','87154627531','70138780695','82141978181','34132984546','25600094479','27134336388','97180557927','31145199775','16136510757','51909819891','64159755629','23088756030','18210132023','89088316901','42107351673','71236153219','23115566624','22161120118','34100268969','82094095468','46070556642','28108663896','18097944717','22304038262','97899426696','97899426696','41008390734','38002563500','65068050582','93492310839','35158875855','65124826722','51925884864','68396672170','68396672170','70152677449','70152677449','18609746009','30163127857','75073503536','64085204379','22304038262','47272839129','47272839129','12141698956','12141698956','22304038262','22304038262','22304038262','22304038262','22304038262','22304038262','68228296864','22304038262','48313148724','22304038262','11871409436','11871409436','22304038262','22304038262','22304038262','38610707536','57525935419','22304038262','22304038262','22304038262','22304038262','22304038262','22304038262','16378409881','40192147977')
--		AND "PERIOD_CATEGORY" = 'PT-A'
--		AND "GJAHR" = '2017'
		;
   
   ELSE 
   lt_workset =
		SELECT 
			"ABN",
			"PERIOD_CATEGORY",
			"PERIOD_KEY",
			"GJAHR"
		FROM
		"osr.edw.platform.fra.prt.dt.abn.wages::CV_ABN_WAGES_KEYS"
		WHERE "ABN"     = :iv_abn
		AND   "GJAHR"   = :iv_gjahr 
		;
   
   END IF;
  
   
lt_param =   
SELECT
TOP 1
	:iv_role_dt                    AS   "PT_ID_ROLE_DATE",
	:iv_pt_role                    AS   "PT_ROLE",
	:iv_id_role                    AS   "ID_ROLE",
	:iv_pt_case_dt                 AS   "PT_CASE_DATE" ,
	:iv_pt_case                    AS   "PT_CASE",
	:iv_flag_abr_acnc              AS   "FLAG_ABR_ACNC", 
	:iv_flag_asic_regd             AS   "FLAG_ASIC_REGD", 
	:iv_flag_sup_gov_exmpt_anzsic  AS   "FLAG_SUP_GOV_EXMPT_ANZSIC"
--	:iv_pt_id_role_date            AS   "PT_ID_ROLE_DATE"
FROM  :lt_workset
;




CALL "osr.edw.platform.fra.prt.dt.abn.wages.se::SP_SelectExclusions"
(
:lt_workset,
lt_out_for_rule 

);

CALL  "osr.edw.platform.fra.prt.dt.abn.wages.ex::SP_ExclusionsCheck"
(
:lt_out_for_rule,
:lt_param ,
et_result ,
et_text

);


END ;