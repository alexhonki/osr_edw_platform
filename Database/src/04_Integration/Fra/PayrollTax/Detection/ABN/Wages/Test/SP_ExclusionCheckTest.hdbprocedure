PROCEDURE "osr.edw.platform.fra.prt.dt.abn.wages.test::SP_ExclusionCheckTest"
( 	IN iv_abn				         NVARCHAR(11) ,
	IN iv_gjahr				         NVARCHAR(4)  ,
	IN iv_role_dt           		 NVARCHAR(8)  ,
	IN iv_pt_role           		 NVARCHAR(1)  ,
	IN iv_id_role           		 NVARCHAR(1)  ,
	IN iv_pt_case_dt            	 NVARCHAR(8)  ,
	IN iv_pt_case           		 NVARCHAR(1)  ,
	IN iv_flag_abr_acnc              NVARCHAR(1)  ,
	IN iv_flag_asic_regd             NVARCHAR(1)  ,
	IN iv_flag_sup_gov_exmpt_anzsic  NVARCHAR(1)  ,
	OUT lt_workset			"osr.edw.platform.fra.prt.dt.abn::Types.wages.ws",
	OUT lt_out_for_rule		"osr.edw.platform.fra.prt.dt.abn::Types.wages.data_exclusions",
--	OUT lt_param			"osr.edw.platform.fra.prt.dt.abn::Types.wages.param_data_exclusions",
	OUT et_result       	"osr.edw.platform.fra.prt.dt.abn::Types.wages.result"

	)
   LANGUAGE SQLSCRIPT
   SQL SECURITY INVOKER
   --DEFAULT SCHEMA <default_schema_name>
   READS SQL DATA AS
BEGIN
   /*************************************
       Write your procedure logic 
   *************************************/
   
   IF :iv_abn = '?' THEN 
   lt_workset =
		SELECT 
			"ABN",
			"PERIOD_CATEGORY",
			"PERIOD_KEY",
			"GJAHR"
		FROM
		"osr.edw.platform.fra.prt.dt.abn.wages::CV_ABN_WAGES_KEYS"
		;
   
   ELSE 
   lt_workset =
		SELECT 
			"ABN",
			"PERIOD_CATEGORY",
			"PERIOD_KEY",
			"GJAHR"
		FROM
		"osr.edw.platform.fra.prt.dt.abn.wages::CV_ABN_WAGES_KEYS"
		WHERE "ABN"     = :iv_abn
		AND   "GJAHR"   = :iv_gjahr 
		;
   
   END IF;
   
   
lt_param =   
SELECT
TOP 1
	:iv_role_dt                    AS   "PARAM.PT_ID_ROLE_DATE",
	:iv_pt_role                    AS   "PARAM.PT_ROLE",
	:iv_id_role                    AS   "PARAM.ID_ROLE",
	:iv_pt_case_dt                 AS   "PARAM.PT_CASE_DATE" ,
	:iv_pt_case                    AS   "PARAM.PT_CASE",
	:iv_flag_abr_acnc              AS   "PARAM.FLAG_ABR_ACNC", 
	:iv_flag_asic_regd             AS   "PARAM.FLAG_ASIC_REGD", 
	:iv_flag_sup_gov_exmpt_anzsic  AS   "PARAM.FLAG_SUP_GOV_EXMPT_ANZSIC"
--	:iv_pt_id_role_date            AS   "PT_ID_ROLE_DATE"
FROM  :lt_workset
;




CALL "osr.edw.platform.fra.prt.dt.abn.wages.se::SP_SelectExclusions"
(
:lt_workset,
lt_out_for_rule 

);

CALL  "osr.edw.platform.fra.prt.dt.abn.wages.ex::SP_ExclusionsCheck"
(
:lt_out_for_rule,
:lt_param ,
et_result 

);


END ;